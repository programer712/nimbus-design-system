import React from 'react';
import { Card, Typography, Box, Skeleton } from '@material-ui/core';
import { makeStyles } from '@material-ui/core/styles';
import {
  WarningTriangleIcon,
  MagnifyingGlassIcon,
  DatabaseIcon,
  CheckListIcon,
  CalendarCallIcon,
} from '../../../assets/icons';
import { TwoLineDescriptionAvatar } from '../../../components';
import { MTheme } from '../../../theme';

const AVATAR_SIZE = '48px';

const useStyles = makeStyles((theme: MTheme) => ({
  root: {
    width: '100%',
    height: '100%',
    padding: theme.spacing(4),

    '& .MuiSkeleton-root': {
      backgroundColor: theme.palette.grey[1100],
      borderRadius: 0,
    }
  },
  header: {
    fontSize: theme.spacing(2.25),
    marginBottom: theme.spacing(4),
    lineHeight: theme.spacing(2.875),
  },
  iconsBlock: {
    width: '100%',
    paddingRight: theme.spacing(8.875),
    display: 'flex',
    justifyContent: 'space-between',
    alignItems: 'center',

    '& .MuiAvatar-root': {
      width: AVATAR_SIZE,
      height: AVATAR_SIZE,
      backgroundColor: `${theme.palette.grey[500]}1E`,
      '& .MuiSvgIcon-root': {
        '& path': {
          fill: theme.palette.primary.main,
        },
      },
    },

    '& h6.MuiTypography-root': {
      fontWeight: 500,
      fontSize: theme.spacing(1.5),
      color: theme.palette.grey[600],
    },
    '& p.MuiTypography-root': {
      fontWeight: 400,
      fontSize: theme.spacing(2),
      color: theme.palette.grey[800],
    },
  },
  flexContainer: {
    display: 'flex',
    alignItems: 'center',
  },
}));

export interface MalwareScannerProps {
  malwareScanner: {
    isScanPerformed: string;
    threatsFound: number;
    scanDate: string;
    databaseUpdateDate: string;
    scanResults: string;
  };
  isLoading: boolean;
}

export function MalwareScanner({ malwareScanner, isLoading }: MalwareScannerProps): JSX.Element | null {
  const classes = useStyles();
  const { isScanPerformed, threatsFound, scanDate, databaseUpdateDate, scanResults } = malwareScanner;
  const malwareData: {
    [key: string]: {
      text: string | null;
      icon: JSX.Element;
    };
  } = {
    'Scan performed': {
      text: 'Yes',
      icon: <MagnifyingGlassIcon />,
    },
    'Threats found': {
      text: threatsFound ? threatsFound.toString() : null,
      icon: <WarningTriangleIcon />,
    },
    'Scan date': {
      text: scanDate,
      icon: <CalendarCallIcon />,
    },
    'Database updated': {
      text: databaseUpdateDate,
      icon: <DatabaseIcon />,
    },
    'Scan results': {
      text: scanResults,
      icon: <CheckListIcon />,
    },
  };

  return isScanPerformed ? (
    <Card className={classes.root}>
      <Typography className={classes.header} variant="subtitle2">
        {isLoading ? (
          <Skeleton data-testid="malware-header-skeleton" variant="text" width="160px" height="11.7px" />
        ) : (
          'Malware scanner'
        )}
      </Typography>
      <Box className={classes.iconsBlock}>
        {Object.keys(malwareData).map((entry) => {
          return isLoading ? (
            <Box key={Math.random()} className={classes.flexContainer}>
              <TwoLineDescriptionAvatar>
                <Skeleton animation="wave" variant="circular" width={AVATAR_SIZE} height={AVATAR_SIZE} />
              </TwoLineDescriptionAvatar>
              <Box>
                <Skeleton variant="text" width="86px" height="11.7px" />
                <Skeleton variant="text" width="106px" height="11.7px" />
              </Box>
            </Box>
          ) : (
            <TwoLineDescriptionAvatar key={entry} primaryText={entry} secondaryText={malwareData[`${entry}`].text}>
              {malwareData[`${entry}`].icon}
            </TwoLineDescriptionAvatar>
          );
        })}
      </Box>
    </Card>
  ) : null;
}
export default MalwareScanner;
